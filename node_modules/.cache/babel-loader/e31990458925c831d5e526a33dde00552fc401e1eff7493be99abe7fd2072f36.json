{"ast":null,"code":"var _jsxFileName = \"/Users/huang/todolist-react-starter/src/contexts/AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useState } from \"react\";\n//由此Context來統一儲存身份狀態\n// import jwt from 'jsonwebtoken'\nimport { jwtDecode } from 'jwt-decode';\nimport { useLocation } from \"react-router-dom\";\nimport { useEffect } from \"react\";\nimport { signup, login, checkPermission } from \"../api/auth\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultAuthContext = {\n  isAuthenticated: false,\n  //判斷使用者是否具有有效憑證, 預設是false, 當取得有效憑證(註冊成功或登入成功)則切換為true \n  currentMember: null,\n  // 當前使用者資料, 預設為null, 成功登入後就會有使用者資料\n  signup: null,\n  //註冊方法\n  login: null,\n  //登入方法\n  logout: null //登出方法\n};\nconst AuthContext = /*#__PURE__*/createContext(defaultAuthContext);\n\n//建立AuthProvider管理狀態,回傳能讓子元件共用的<AuthContext.Provider>\n\n//輸出context hook \nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [payload, setPayload] = useState(null); //這個payload存打api回來的authToken\n\n  //把判斷身份是否有效的useEffect搬進來\n  const {\n    pathname\n  } = useLocation();\n  useEffect(() => {\n    const CheckTokenIsValid = async () => {\n      const authToken = localStorage.getItem(\"authToken\");\n\n      //如果沒有authToken, 停止檢查, 停留此頁\n      if (!authToken) {\n        console.log(\"authToken is not existed!\");\n        setIsAuthenticated(false);\n        setPayload(null);\n        return;\n      }\n      const isValid = await checkPermission(authToken); // 傳入 authToken 字串\n      if (isValid) {\n        setIsAuthenticated(true);\n        const tempPayload = jwtDecode(authToken);\n        setPayload(tempPayload);\n      } else {\n        setIsAuthenticated(false);\n        setPayload(null);\n        console.log(\"Invalid auth token\");\n      }\n    };\n    CheckTokenIsValid();\n  }, [pathname]);\n\n  //只要state狀態更新,接連更新provider所帶的value值\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      isAuthenticated,\n      currentMember: payload && {\n        id: payload.sub,\n        name: payload.name\n      },\n      //因為authContext不會知道註冊表單輸入的值,補上data作為調用選項\n      signup: async data => {\n        const {\n          success,\n          authToken\n        } = await signup({\n          username: data.username,\n          email: data.email,\n          password: data.password\n        });\n        const tempPayload = jwtDecode(authToken);\n        //先確認payload是否存在, 存在才代表登入有效, 就存起來\n        if (tempPayload) {\n          setPayload(tempPayload);\n          setIsAuthenticated(true); //註冊成功\n          localStorage.setItem(\"authToken\", authToken);\n        } else {\n          setPayload(null);\n          setIsAuthenticated(false);\n        }\n        return success;\n      },\n      login: async data => {\n        const {\n          success,\n          authToken\n        } = await login({\n          username: data.username,\n          password: data.password\n        });\n        if (authToken) {\n          const tempPayload = jwtDecode(authToken);\n          setPayload(tempPayload);\n          setIsAuthenticated(true);\n          localStorage.setItem(\"authToken\", authToken); // 確保正確儲存\n        } else {\n          setPayload(null);\n          setIsAuthenticated(false);\n        }\n        return success;\n      },\n      logout: () => {\n        localStorage.removeItem(\"authToken\");\n        setIsAuthenticated(false);\n        setPayload(null);\n      }\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"XeLZc7uDGF+Gk4an/nihe0Mv/08=\", false, function () {\n  return [useLocation];\n});\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useState","jwtDecode","useLocation","useEffect","signup","login","checkPermission","jsxDEV","_jsxDEV","defaultAuthContext","isAuthenticated","currentMember","logout","AuthContext","useAuth","_s","AuthProvider","children","_s2","setIsAuthenticated","payload","setPayload","pathname","CheckTokenIsValid","authToken","localStorage","getItem","console","log","isValid","tempPayload","Provider","value","id","sub","name","data","success","username","email","password","setItem","removeItem","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/huang/todolist-react-starter/src/contexts/AuthContext.jsx"],"sourcesContent":["import { createContext, useContext, useState } from \"react\"\n//由此Context來統一儲存身份狀態\n// import jwt from 'jsonwebtoken'\nimport { jwtDecode } from 'jwt-decode'\nimport { useLocation } from \"react-router-dom\"\nimport { useEffect } from \"react\"\nimport { signup, login, checkPermission } from \"../api/auth\"\n\nconst defaultAuthContext = {\n  isAuthenticated: false, //判斷使用者是否具有有效憑證, 預設是false, 當取得有效憑證(註冊成功或登入成功)則切換為true \n  currentMember: null, // 當前使用者資料, 預設為null, 成功登入後就會有使用者資料\n  signup: null, //註冊方法\n  login: null, //登入方法\n  logout: null //登出方法\n}\n\nconst AuthContext = createContext(defaultAuthContext)\n\n//建立AuthProvider管理狀態,回傳能讓子元件共用的<AuthContext.Provider>\n\n//輸出context hook \nexport const useAuth = () => useContext(AuthContext);\nexport const AuthProvider = ({children}) => {\n  const [isAuthenticated, setIsAuthenticated]=useState(false)\n  const [payload, setPayload]=useState(null)//這個payload存打api回來的authToken\n\n  //把判斷身份是否有效的useEffect搬進來\n  const {pathname} = useLocation()\n\n    useEffect(() => {\n      const CheckTokenIsValid = async() => {\n        const authToken = localStorage.getItem(\"authToken\");\n\n        //如果沒有authToken, 停止檢查, 停留此頁\n        if (!authToken) {\n          console.log(\"authToken is not existed!\")\n          setIsAuthenticated(false)\n          setPayload(null)\n          return;\n        }\n\n        const isValid = await checkPermission(authToken); // 傳入 authToken 字串\n        if (isValid) {\n          setIsAuthenticated(true);\n          const tempPayload = jwtDecode(authToken);\n          setPayload(tempPayload);\n        } else {\n          setIsAuthenticated(false);\n          setPayload(null);\n          console.log(\"Invalid auth token\");\n        }\n      }\n\n      CheckTokenIsValid();\n    }, [pathname]);\n\n\n   //只要state狀態更新,接連更新provider所帶的value值\n  return (\n    <AuthContext.Provider\n      value={{\n        isAuthenticated,\n        currentMember: payload && {\n          id: payload.sub,\n          name: payload.name,\n        },\n        //因為authContext不會知道註冊表單輸入的值,補上data作為調用選項\n        signup: async (data) => {\n          const { success, authToken } = await signup({\n            username: data.username,\n            email: data.email,\n            password: data.password,\n          });\n          const tempPayload = jwtDecode(authToken);\n          //先確認payload是否存在, 存在才代表登入有效, 就存起來\n          if (tempPayload) {\n            setPayload(tempPayload);\n            setIsAuthenticated(true); //註冊成功\n            localStorage.setItem(\"authToken\", authToken);\n          } else {\n            setPayload(null);\n            setIsAuthenticated(false);\n          }\n          return success;\n        },\n        login: async (data) => {\n          const { success, authToken } = await login({\n            username: data.username,\n            password: data.password,\n          });\n\n          if (authToken) {\n            const tempPayload = jwtDecode(authToken);\n            setPayload(tempPayload);\n            setIsAuthenticated(true);\n            localStorage.setItem(\"authToken\", authToken); // 確保正確儲存\n          } else {\n            setPayload(null);\n            setIsAuthenticated(false);\n          }\n          return success;\n        },\n        logout: () => {\n          localStorage.removeItem(\"authToken\");\n          setIsAuthenticated(false);\n          setPayload(null);\n        },\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}