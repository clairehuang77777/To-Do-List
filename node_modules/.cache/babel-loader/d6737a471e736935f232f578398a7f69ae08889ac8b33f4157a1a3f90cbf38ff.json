{"ast":null,"code":"var _jsxFileName = \"/Users/huang/todolist-react-starter/src/pages/TodoPage.jsx\",\n  _s = $RefreshSig$();\nimport { Footer, Header, TodoCollection, TodoInput } from '../components';\nimport { useState } from 'react';\nimport { useEffect } from 'react';\nimport { deleteTodos, getTodos, patchTodos, postTodos } from '../api/todo';\nimport { useNavigate } from 'react-router-dom';\n// import { checkPermission } from '../api/auth';\nimport { useAuth } from '../contexts/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TodoPage = () => {\n  _s();\n  const [inputValue, setInputValue] = useState(\"\");\n  const [todos, setTodos] = useState([]);\n  const navigate = useNavigate();\n  const {\n    isAuthenticated,\n    currentMember\n  } = useAuth(); //取出要使用的狀態跟方法\n\n  function handleChange(e) {\n    setInputValue(e.target.value);\n    console.log(inputValue);\n  }\n  async function handleAddToDoClick() {\n    if (inputValue.length === 0) {\n      return;\n    }\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false\n      });\n      console.log(\"second async/await function to give a promise result\");\n      setTodos(prevTodos => {\n        return [...prevTodos, {\n          title: data.title,\n          isDone: data.isDone,\n          id: data.id\n        }];\n      });\n      console.log(\"new data into todos state\");\n      console.log(\"later trigger react native re-render for item with todos\");\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  async function handleOnKeyDown() {\n    if (inputValue.length === 0) {\n      return;\n    }\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false\n      });\n      setTodos(prevTodos => {\n        return [...prevTodos, {\n          title: data.title,\n          isDone: data.isDone,\n          id: data.id\n        }];\n      });\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  async function handleToggleDone(id) {\n    const currentTodo = todos.find(todo => todo.id === id);\n    try {\n      const data = await patchTodos({\n        id,\n        isDone: !currentTodo.isDone\n      });\n      setTodos(prevTodos => {\n        return prevTodos.map(item => item.id === id ? {\n          ...item,\n          id: data.id,\n          isDone: data.isDone\n        } : item);\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  function handleChangeMode({\n    id,\n    isEdit\n  }) {\n    setTodos(prevTodos => {\n      return prevTodos.map(todo => {\n        if (todo.id === id) {\n          console.log(`Todo with ID ${id} is now editable.`);\n          return {\n            ...todo,\n            isEdit\n          };\n        }\n        return {\n          ...todo,\n          isEdit: false\n        };\n      });\n    });\n  }\n  async function handleSave({\n    id,\n    title\n  }) {\n    console.log(\"saving todo\", id, title);\n    try {\n      await patchTodos({\n        id,\n        title\n      });\n      setTodos(prevTodos => {\n        return prevTodos.map(todo => {\n          if (todo.id === id) {\n            return {\n              ...todo,\n              title,\n              isEdit: false\n            };\n          }\n          return {\n            ...todo\n          };\n        });\n      });\n      console.log(todos);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  async function handleDelete(id) {\n    //套用 deleteTodos()使用axios打delete request\n    try {\n      const data = await deleteTodos(id);\n      setTodos(prevtodos => {\n        return prevtodos.filter(item => {\n          if (item.id !== data.id) {\n            return {\n              ...item\n            };\n          }\n        });\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  //使用此hook讓react讓外部系統連接\n  //此useEffect的意義：初始化數據\n  useEffect(() => {\n    async function getTodosAsync() {\n      try {\n        const todos = await getTodos();\n        setTodos(todos.map(todo => ({\n          ...todo,\n          isEdit: false\n        })));\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    getTodosAsync();\n  }, []);\n\n  //此useEffect的意義：驗證授權\n  useEffect(() => {\n    if (!isAuthenticated) {\n      navigate('/login');\n      console.log('authentication failed');\n    } else {\n      return;\n    }\n  }, [navigate, isAuthenticated]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [\"TodoPage\", /*#__PURE__*/_jsxDEV(Header, {\n      username: currentMember.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TodoInput, {\n      inputValue: inputValue,\n      onChange: handleChange,\n      onAddTodo: handleAddToDoClick,\n      onKeyDown: handleOnKeyDown\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TodoCollection, {\n      todos: todos,\n      onToggleDone: handleToggleDone,\n      onChangeMode: handleChangeMode // 确保正确传入函数\n      ,\n      onSave: handleSave,\n      onDelete: handleDelete\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {\n      todos: todos\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 184,\n    columnNumber: 5\n  }, this);\n};\n_s(TodoPage, \"mC3mwKuXzQ9m+kR5x9laUScdhLo=\", false, function () {\n  return [useNavigate, useAuth];\n});\n_c = TodoPage;\nexport default TodoPage;\nvar _c;\n$RefreshReg$(_c, \"TodoPage\");","map":{"version":3,"names":["Footer","Header","TodoCollection","TodoInput","useState","useEffect","deleteTodos","getTodos","patchTodos","postTodos","useNavigate","useAuth","jsxDEV","_jsxDEV","TodoPage","_s","inputValue","setInputValue","todos","setTodos","navigate","isAuthenticated","currentMember","handleChange","e","target","value","console","log","handleAddToDoClick","length","data","title","isDone","prevTodos","id","error","handleOnKeyDown","handleToggleDone","currentTodo","find","todo","map","item","handleChangeMode","isEdit","handleSave","handleDelete","prevtodos","filter","getTodosAsync","children","username","name","fileName","_jsxFileName","lineNumber","columnNumber","onChange","onAddTodo","onKeyDown","onToggleDone","onChangeMode","onSave","onDelete","_c","$RefreshReg$"],"sources":["/Users/huang/todolist-react-starter/src/pages/TodoPage.jsx"],"sourcesContent":["import { Footer, Header, TodoCollection, TodoInput } from '../components';\nimport { useState } from 'react';\nimport { useEffect } from 'react';\nimport { deleteTodos, getTodos,patchTodos,postTodos } from '../api/todo';\nimport { useNavigate } from 'react-router-dom';\n// import { checkPermission } from '../api/auth';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst TodoPage = () => {\n  const [inputValue, setInputValue] = useState(\"\");\n  const [todos, setTodos] = useState([]);\n  const navigate = useNavigate();\n  const { isAuthenticated, currentMember } = useAuth() //取出要使用的狀態跟方法\n\n  function handleChange(e) {\n    setInputValue(e.target.value);\n    console.log(inputValue);\n  }\n\n  async function handleAddToDoClick() {\n    if (inputValue.length === 0) {\n      return;\n    }\n\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false,\n      });\n      console.log(\"second async/await function to give a promise result\");\n      setTodos((prevTodos) => {\n        return [\n          ...prevTodos,\n          {\n            title: data.title,\n            isDone: data.isDone,\n            id: data.id,\n          },\n        ];\n      });\n      console.log(\"new data into todos state\");\n      console.log(\"later trigger react native re-render for item with todos\");\n\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleOnKeyDown() {\n    if (inputValue.length === 0) {\n      return;\n    }\n\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false,\n      });\n\n      setTodos((prevTodos) => {\n        return [\n          ...prevTodos,\n          {\n            title: data.title,\n            isDone: data.isDone,\n            id: data.id,\n          },\n        ];\n      });\n\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleToggleDone(id) {\n    const currentTodo = todos.find((todo) => todo.id === id);\n    try {\n      const data = await patchTodos({\n        id,\n        isDone: !currentTodo.isDone,\n      });\n      setTodos((prevTodos) => {\n        return prevTodos.map((item) =>\n          item.id === id ? { ...item, id: data.id, isDone: data.isDone } : item\n        );\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  function handleChangeMode({ id, isEdit }) {\n    setTodos((prevTodos) => {\n      return prevTodos.map((todo) => {\n        if (todo.id === id) {\n          console.log(`Todo with ID ${id} is now editable.`);\n          return { ...todo, isEdit };\n        }\n        return { ...todo, isEdit: false };\n      });\n    });\n  }\n\n  async function handleSave({ id, title }) {\n    console.log(\"saving todo\", id, title);\n    try {\n      await patchTodos({\n        id,\n        title,\n      });\n      setTodos((prevTodos) => {\n        return prevTodos.map((todo) => {\n          if (todo.id === id) {\n            return {\n              ...todo,\n              title,\n              isEdit: false,\n            };\n          }\n          return {\n            ...todo,\n          };\n        });\n      });\n      console.log(todos);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleDelete(id) {\n    //套用 deleteTodos()使用axios打delete request\n    try {\n      const data = await deleteTodos(id);\n\n      setTodos((prevtodos) => {\n        return prevtodos.filter((item) => {\n          if (item.id !== data.id) {\n            return {\n              ...item,\n            };\n          }\n        });\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  //使用此hook讓react讓外部系統連接\n  //此useEffect的意義：初始化數據\n  useEffect(() => {\n    async function getTodosAsync() {\n      try {\n        const todos = await getTodos();\n        setTodos(\n          todos.map((todo) => ({\n            ...todo,\n            isEdit: false,\n          }))\n        );\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    getTodosAsync();\n  }, []);\n\n  //此useEffect的意義：驗證授權\n  useEffect(() => {\n    if (!isAuthenticated){\n      navigate('/login')\n      console.log('authentication failed')\n    } else {\n      return\n    }\n     \n  }, [navigate,isAuthenticated]);\n\n  return (\n    <div>\n      TodoPage\n      <Header username={currentMember.name}/>\n      <TodoInput\n        inputValue={inputValue}\n        onChange={handleChange}\n        onAddTodo={handleAddToDoClick}\n        onKeyDown={handleOnKeyDown}\n      />\n      <TodoCollection\n        todos={todos}\n        onToggleDone={handleToggleDone}\n        onChangeMode={handleChangeMode} // 确保正确传入函数\n        onSave={handleSave}\n        onDelete={handleDelete}\n      />\n      <Footer todos={todos} />\n    </div>\n  );\n}\n\nexport default TodoPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}