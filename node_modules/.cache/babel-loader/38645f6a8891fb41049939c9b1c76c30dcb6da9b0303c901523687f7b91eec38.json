{"ast":null,"code":"import _objectSpread from\"/Users/huang/todolist-react-starter/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{Footer,Header,TodoCollection,TodoInput}from'../components';import{useState}from'react';import{useEffect}from'react';import{deleteTodos,getTodos,patchTodos,postTodos}from'../api/todo';import{useNavigate}from'react-router-dom';// import { checkPermission } from '../api/auth';\nimport{useAuth}from'../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TodoPage=()=>{const[inputValue,setInputValue]=useState(\"\");const[todos,setTodos]=useState([]);const navigate=useNavigate();const{isAuthenticated,currentMember}=useAuth();//取出要使用的狀態跟方法\nfunction handleChange(e){setInputValue(e.target.value);console.log(inputValue);}async function handleAddToDoClick(){if(inputValue.length===0){return;}try{const data=await postTodos({title:inputValue,isDone:false});console.log(\"second async/await function to give a promise result\");setTodos(prevTodos=>{return[...prevTodos,{title:data.title,isDone:data.isDone,id:data.id}];});console.log(\"new data into todos state\");console.log(\"later trigger react native re-render for item with todos\");setInputValue(\"\");}catch(error){console.error(error);}}async function handleOnKeyDown(){if(inputValue.length===0){return;}try{const data=await postTodos({title:inputValue,isDone:false});setTodos(prevTodos=>{return[...prevTodos,{title:data.title,isDone:data.isDone,id:data.id}];});setInputValue(\"\");}catch(error){console.error(error);}}async function handleToggleDone(id){const currentTodo=todos.find(todo=>todo.id===id);try{const data=await patchTodos({id,isDone:!currentTodo.isDone});setTodos(prevTodos=>{return prevTodos.map(item=>item.id===id?_objectSpread(_objectSpread({},item),{},{id:data.id,isDone:data.isDone}):item);});}catch(error){console.error(error);}}function handleChangeMode(_ref){let{id,isEdit}=_ref;setTodos(prevTodos=>{return prevTodos.map(todo=>{if(todo.id===id){console.log(\"Todo with ID \".concat(id,\" is now editable.\"));return _objectSpread(_objectSpread({},todo),{},{isEdit});}return _objectSpread(_objectSpread({},todo),{},{isEdit:false});});});}async function handleSave(_ref2){let{id,title}=_ref2;console.log(\"saving todo\",id,title);try{await patchTodos({id,title});setTodos(prevTodos=>{return prevTodos.map(todo=>{if(todo.id===id){return _objectSpread(_objectSpread({},todo),{},{title,isEdit:false});}return _objectSpread({},todo);});});console.log(todos);}catch(error){console.error(error);}}async function handleDelete(id){//套用 deleteTodos()使用axios打delete request\ntry{const data=await deleteTodos(id);setTodos(prevtodos=>{return prevtodos.filter(item=>{if(item.id!==data.id){return _objectSpread({},item);}});});}catch(error){console.error(error);}}//使用此hook讓react讓外部系統連接\n//此useEffect的意義：初始化數據\nuseEffect(()=>{async function getTodosAsync(){try{const todos=await getTodos();setTodos(todos.map(todo=>_objectSpread(_objectSpread({},todo),{},{isEdit:false})));}catch(error){console.error(error);}}getTodosAsync();},[]);//此useEffect的意義：驗證授權\nuseEffect(()=>{if(!isAuthenticated){navigate('/login');console.log('authentication failed');}},[navigate,isAuthenticated]);return/*#__PURE__*/_jsxs(\"div\",{children:[\"TodoPage\",/*#__PURE__*/_jsx(Header,{username:currentMember?currentMember.name:\"Guest\"}),/*#__PURE__*/_jsx(TodoInput,{inputValue:inputValue,onChange:handleChange,onAddTodo:handleAddToDoClick,onKeyDown:handleOnKeyDown}),/*#__PURE__*/_jsx(TodoCollection,{todos:todos,onToggleDone:handleToggleDone,onChangeMode:handleChangeMode// 确保正确传入函数\n,onSave:handleSave,onDelete:handleDelete}),/*#__PURE__*/_jsx(Footer,{todos:todos.length})]});};export default TodoPage;","map":{"version":3,"names":["Footer","Header","TodoCollection","TodoInput","useState","useEffect","deleteTodos","getTodos","patchTodos","postTodos","useNavigate","useAuth","jsx","_jsx","jsxs","_jsxs","TodoPage","inputValue","setInputValue","todos","setTodos","navigate","isAuthenticated","currentMember","handleChange","e","target","value","console","log","handleAddToDoClick","length","data","title","isDone","prevTodos","id","error","handleOnKeyDown","handleToggleDone","currentTodo","find","todo","map","item","_objectSpread","handleChangeMode","_ref","isEdit","concat","handleSave","_ref2","handleDelete","prevtodos","filter","getTodosAsync","children","username","name","onChange","onAddTodo","onKeyDown","onToggleDone","onChangeMode","onSave","onDelete"],"sources":["/Users/huang/todolist-react-starter/src/pages/TodoPage.jsx"],"sourcesContent":["import { Footer, Header, TodoCollection, TodoInput } from '../components';\nimport { useState } from 'react';\nimport { useEffect } from 'react';\nimport { deleteTodos, getTodos,patchTodos,postTodos } from '../api/todo';\nimport { useNavigate } from 'react-router-dom';\n// import { checkPermission } from '../api/auth';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst TodoPage = () => {\n  const [inputValue, setInputValue] = useState(\"\");\n  const [todos, setTodos] = useState([]);\n  const navigate = useNavigate();\n  const { isAuthenticated, currentMember } = useAuth() //取出要使用的狀態跟方法\n\n  function handleChange(e) {\n    setInputValue(e.target.value);\n    console.log(inputValue);\n  }\n\n  async function handleAddToDoClick() {\n    if (inputValue.length === 0) {\n      return;\n    }\n\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false,\n      });\n      console.log(\"second async/await function to give a promise result\");\n      setTodos((prevTodos) => {\n        return [\n          ...prevTodos,\n          {\n            title: data.title,\n            isDone: data.isDone,\n            id: data.id,\n          },\n        ];\n      });\n      console.log(\"new data into todos state\");\n      console.log(\"later trigger react native re-render for item with todos\");\n\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleOnKeyDown() {\n    if (inputValue.length === 0) {\n      return;\n    }\n\n    try {\n      const data = await postTodos({\n        title: inputValue,\n        isDone: false,\n      });\n\n      setTodos((prevTodos) => {\n        return [\n          ...prevTodos,\n          {\n            title: data.title,\n            isDone: data.isDone,\n            id: data.id,\n          },\n        ];\n      });\n\n      setInputValue(\"\");\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleToggleDone(id) {\n    const currentTodo = todos.find((todo) => todo.id === id);\n    try {\n      const data = await patchTodos({\n        id,\n        isDone: !currentTodo.isDone,\n      });\n      setTodos((prevTodos) => {\n        return prevTodos.map((item) =>\n          item.id === id ? { ...item, id: data.id, isDone: data.isDone } : item\n        );\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  function handleChangeMode({ id, isEdit }) {\n    setTodos((prevTodos) => {\n      return prevTodos.map((todo) => {\n        if (todo.id === id) {\n          console.log(`Todo with ID ${id} is now editable.`);\n          return { ...todo, isEdit };\n        }\n        return { ...todo, isEdit: false };\n      });\n    });\n  }\n\n  async function handleSave({ id, title }) {\n    console.log(\"saving todo\", id, title);\n    try {\n      await patchTodos({\n        id,\n        title,\n      });\n      setTodos((prevTodos) => {\n        return prevTodos.map((todo) => {\n          if (todo.id === id) {\n            return {\n              ...todo,\n              title,\n              isEdit: false,\n            };\n          }\n          return {\n            ...todo,\n          };\n        });\n      });\n      console.log(todos);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async function handleDelete(id) {\n    //套用 deleteTodos()使用axios打delete request\n    try {\n      const data = await deleteTodos(id);\n\n      setTodos((prevtodos) => {\n        return prevtodos.filter((item) => {\n          if (item.id !== data.id) {\n            return {\n              ...item,\n            };\n          }\n        });\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  //使用此hook讓react讓外部系統連接\n  //此useEffect的意義：初始化數據\n  useEffect(() => {\n    async function getTodosAsync() {\n      try {\n        const todos = await getTodos();\n        setTodos(\n          todos.map((todo) => ({\n            ...todo,\n            isEdit: false,\n          }))\n        );\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    getTodosAsync();\n  }, []);\n\n  //此useEffect的意義：驗證授權\n  useEffect(() => {\n    if (!isAuthenticated){\n      navigate('/login')\n      console.log('authentication failed')\n    }      \n  }, [navigate,isAuthenticated]);\n\n  return (\n    <div>\n      TodoPage\n      <Header username={currentMember ? currentMember.name : \"Guest\"} />\n      <TodoInput\n        inputValue={inputValue}\n        onChange={handleChange}\n        onAddTodo={handleAddToDoClick}\n        onKeyDown={handleOnKeyDown}\n      />\n      <TodoCollection\n        todos={todos}\n        onToggleDone={handleToggleDone}\n        onChangeMode={handleChangeMode} // 确保正确传入函数\n        onSave={handleSave}\n        onDelete={handleDelete}\n      />\n      <Footer todos={todos.length} />\n    </div>\n  );\n}\n\nexport default TodoPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}